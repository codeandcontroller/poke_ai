<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pokémon Card Search</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v='2') }}">
</head>
<body>
  <h1>Pokémon Card Search</h1>

  <form method="POST">
    <input type="text" name="name" placeholder="Card name (e.g., Pikachu)" value="{{ request.form.get('name','') }}">
    <input type="text" name="set_name" placeholder="Set name (e.g., Base Set)" value="{{ request.form.get('set_name','') }}">
    <input type="text" name="number" placeholder="Card number (e.g., 4)" value="{{ request.form.get('number','') }}">

    <select name="rarity">
      <option value="">Any Rarity</option>
      {% for r in ["Common","Uncommon","Rare","Rare Holo","Ultra Rare"] %}
        <option value="{{ r }}" {% if request.form.get('rarity')==r %}selected{% endif %}>{{ r }}</option>
      {% endfor %}
    </select>

    <select name="type">
      <option value="">Any Type</option>
      {% for t in ["Fire","Water","Grass","Electric","Psychic","Fighting","Darkness","Metal","Fairy","Dragon","Colorless"] %}
        <option value="{{ t }}" {% if request.form.get('type')==t %}selected{% endif %}>{{ t }}</option>
      {% endfor %}
    </select>

    <button type="submit">Search</button>
  </form>

  {% if results is defined %}
    {% if results %}
      <div class="grid">
        {% for card in results %}
         <div class="card">
  <h2>{{ card.name }}</h2>
  <p class="muted">
    <b>Set:</b> {{ card.set.name }} &nbsp;•&nbsp;
    <b>No.:</b> {{ card.number }} &nbsp;•&nbsp;
    <b>Rarity:</b> {{ card.rarity or "N/A" }}
  </p>
  <img src="{{ card.images.small }}" alt="{{ card.name }}">

  {% set p = card._price %}
  {% if p %}
    <p class="price">
      <b>TCGplayer ({{ p.variant }})</b><br>
      Market:
      {% if p.market is not none %}
        ${{ '%.2f'|format(p.market) }}
      {% else %}
        —
      {% endif %}
      &nbsp;| Mid:
      {% if p.mid is not none %}
        ${{ '%.2f'|format(p.mid) }}
      {% else %}
        —
      {% endif %}
      <br>
      <span class="muted">
        Low:
        {{ ('$' + ('%.2f'|format(p.low))) if p.low is not none else '—' }}
        &nbsp;| High:
        {{ ('$' + ('%.2f'|format(p.high))) if p.high is not none else '—' }}
        {% if p.updatedAt %} • Updated {{ p.updatedAt }}{% endif %}
      </span>
    </p>
  {% else %}
    <p class="muted">No TCGplayer price found.</p>
  {% endif %}
</div>

        {% endfor %}
      </div>
    {% else %}
      <p style="text-align:center;">No cards found.</p>
    {% endif %}
  {% endif %}
</body>
</html>
